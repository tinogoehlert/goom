package graphics

import (
	"image/color"

	"github.com/tinogoehlert/goom/wad"
)

const (
	numPalettes = 14
)

var defaultPalette = Palette{
	Colors: [256]color.RGBA{
		{0, 0, 0, 255}, {31, 23, 11, 255}, {23, 15, 7, 255}, {75, 75, 75, 255},
		{255, 255, 255, 255}, {27, 27, 27, 255}, {19, 19, 19, 255}, {11, 11, 11, 255},
		{7, 7, 7, 255}, {47, 55, 31, 255}, {35, 43, 15, 255}, {23, 31, 7, 255},
		{15, 23, 0, 255}, {79, 59, 43, 255}, {71, 51, 35, 255}, {63, 43, 27, 255},
		{255, 183, 183, 255}, {247, 171, 171, 255}, {243, 163, 163, 255}, {235, 151, 151, 255},
		{231, 143, 143, 255}, {223, 135, 135, 255}, {219, 123, 123, 255}, {211, 115, 115, 255},
		{203, 107, 107, 255}, {199, 99, 99, 255}, {191, 91, 91, 255}, {187, 87, 87, 255},
		{179, 79, 79, 255}, {175, 71, 71, 255}, {167, 63, 63, 255}, {163, 59, 59, 255},
		{155, 51, 51, 255}, {151, 47, 47, 255}, {143, 43, 43, 255}, {139, 35, 35, 255},
		{131, 31, 31, 255}, {127, 27, 27, 255}, {119, 23, 23, 255}, {115, 19, 19, 255},
		{107, 15, 15, 255}, {103, 11, 11, 255}, {95, 7, 7, 255}, {91, 7, 7, 255},
		{83, 7, 7, 255}, {79, 0, 0, 255}, {71, 0, 0, 255}, {67, 0, 0, 255},
		{255, 235, 223, 255}, {255, 227, 211, 255}, {255, 219, 199, 255},
		{255, 211, 187, 255}, {255, 207, 179, 255}, {255, 199, 167, 255},
		{255, 191, 155, 255}, {255, 187, 147, 255}, {255, 179, 131, 255},
		{247, 171, 123, 255}, {239, 163, 115, 255}, {231, 155, 107, 255},
		{223, 147, 99, 255}, {215, 139, 91, 255}, {207, 131, 83, 255}, {203, 127, 79, 255},
		{191, 123, 75, 255}, {179, 115, 71, 255}, {171, 111, 67, 255}, {163, 107, 63, 255},
		{155, 99, 59, 255}, {143, 95, 55, 255}, {135, 87, 51, 255}, {127, 83, 47, 255},
		{119, 79, 43, 255}, {107, 71, 39, 255}, {95, 67, 35, 255}, {83, 63, 31, 255},
		{75, 55, 27, 255}, {63, 47, 23, 255}, {51, 43, 19, 255}, {43, 35, 15, 255},
		{239, 239, 239, 255}, {231, 231, 231, 255}, {223, 223, 223, 255}, {219, 219, 219, 255},
		{211, 211, 211, 255}, {203, 203, 203, 255}, {199, 199, 199, 255}, {191, 191, 191, 255},
		{183, 183, 183, 255}, {179, 179, 179, 255}, {171, 171, 171, 255}, {167, 167, 167, 255},
		{159, 159, 159, 255}, {151, 151, 151, 255}, {147, 147, 147, 255}, {139, 139, 139, 255},
		{131, 131, 131, 255}, {127, 127, 127, 255}, {119, 119, 119, 255}, {111, 111, 111, 255},
		{107, 107, 107, 255}, {99, 99, 99, 255}, {91, 91, 91, 255}, {87, 87, 87, 255},
		{79, 79, 79, 255}, {71, 71, 71, 255}, {67, 67, 67, 255}, {59, 59, 59, 255},
		{55, 55, 55, 255}, {47, 47, 47, 255}, {39, 39, 39, 255}, {35, 35, 35, 255},
		{119, 255, 111, 255}, {111, 239, 103, 255}, {103, 223, 95, 255}, {95, 207, 87, 255},
		{91, 191, 79, 255}, {83, 175, 71, 255}, {75, 159, 63, 255}, {67, 147, 55, 255},
		{63, 131, 47, 255}, {55, 115, 43, 255}, {47, 99, 35, 255}, {39, 83, 27, 255},
		{31, 67, 23, 255}, {23, 51, 15, 255}, {19, 35, 11, 255}, {11, 23, 7, 255},
		{191, 167, 143, 255}, {183, 159, 135, 255}, {175, 151, 127, 255}, {167, 143, 119, 255}, {159, 135, 111, 255},
		{155, 127, 107, 255}, {147, 123, 99, 255}, {139, 115, 91, 255}, {131, 107, 87, 255},
		{123, 99, 79, 255}, {119, 95, 75, 255}, {111, 87, 67, 255}, {103, 83, 63, 255},
		{95, 75, 55, 255}, {87, 67, 51, 255}, {83, 63, 47, 255}, {159, 131, 99, 255},
		{143, 119, 83, 255}, {131, 107, 75, 255}, {119, 95, 63, 255}, {103, 83, 51, 255},
		{91, 71, 43, 255}, {79, 59, 35, 255}, {67, 51, 27, 255}, {123, 127, 99, 255},
		{111, 115, 87, 255}, {103, 107, 79, 255}, {91, 99, 71, 255}, {83, 87, 59, 255},
		{71, 79, 51, 255}, {63, 71, 43, 255}, {55, 63, 39, 255}, {255, 255, 115, 255},
		{235, 219, 87, 255}, {215, 187, 67, 255}, {195, 155, 47, 255}, {175, 123, 31, 255},
		{155, 91, 19, 255}, {135, 67, 7, 255}, {115, 43, 0, 255}, {255, 255, 255, 255},
		{255, 219, 219, 255}, {255, 187, 187, 255}, {255, 155, 155, 255}, {255, 123, 123, 255},
		{255, 95, 95, 255}, {255, 63, 63, 255}, {255, 31, 31, 255}, {255, 0, 0, 255}, {239, 0, 0, 255},
		{227, 0, 0, 255}, {215, 0, 0, 255}, {203, 0, 0, 255}, {191, 0, 0, 255}, {179, 0, 0, 255},
		{167, 0, 0, 255}, {155, 0, 0, 255}, {139, 0, 0, 255}, {127, 0, 0, 255}, {115, 0, 0, 255},
		{103, 0, 0, 255}, {91, 0, 0, 255}, {79, 0, 0, 255}, {67, 0, 0, 255}, {231, 231, 255, 255},
		{199, 199, 255, 255}, {171, 171, 255, 255}, {143, 143, 255, 255}, {115, 115, 255, 255},
		{83, 83, 255, 255}, {55, 55, 255, 255}, {27, 27, 255, 255}, {0, 0, 255, 255},
		{0, 0, 227, 255}, {0, 0, 203, 255}, {0, 0, 179, 255}, {0, 0, 155, 255},
		{0, 0, 131, 255}, {0, 0, 107, 255}, {0, 0, 83, 255}, {255, 255, 255, 255},
		{255, 235, 219, 255}, {255, 215, 187, 255}, {255, 199, 155, 255}, {255, 179, 123, 255},
		{255, 163, 91, 255}, {255, 143, 59, 255}, {255, 127, 27, 255}, {243, 115, 23, 255},
		{235, 111, 15, 255}, {223, 103, 15, 255}, {215, 95, 11, 255}, {203, 87, 7, 255},
		{195, 79, 0, 255}, {183, 71, 0, 255}, {175, 67, 0, 255}, {255, 255, 255, 255}, {255, 255, 215, 255},
		{255, 255, 179, 255}, {255, 255, 143, 255}, {255, 255, 107, 255}, {255, 255, 71, 255}, {255, 255, 35, 255},
		{255, 255, 0, 255}, {167, 63, 0, 255}, {159, 55, 0, 255}, {147, 47, 0, 255}, {135, 35, 0, 255}, {79, 59, 39, 255},
		{67, 47, 27, 255}, {55, 35, 19, 255}, {47, 27, 11, 255}, {0, 0, 83, 255}, {0, 0, 71, 255}, {0, 0, 59, 255},
		{0, 0, 47, 255}, {0, 0, 35, 255}, {0, 0, 23, 255}, {0, 0, 11, 255}, {0, 0, 0, 255}, {255, 159, 67, 255},
		{255, 231, 75, 255}, {255, 123, 255, 255}, {255, 0, 255, 255}, {207, 0, 207, 255}, {159, 0, 155, 255},
		{111, 0, 107, 255}, {167, 107, 107, 255}},
}

// Palette DOOM color palette
type Palette struct {
	Colors [256]color.RGBA
}

// Palettes one or more palettes
type Palettes [numPalettes]Palette

// NewPalettes one or more palettes
func NewPalettes(w *wad.WAD) (*Palettes, error) {
	var palettes = Palettes{defaultPalette}
	for _, lump := range w.Lumps() {
		if lump.Name == "PLAYPAL" {
			for i := 0; i < numPalettes; i++ {
				p := Palette{}
				for ci := 0; ci < 256*3; ci += 3 {
					p.Colors[ci/3].R = lump.Data[ci]
					p.Colors[ci/3].G = lump.Data[ci+1]
					p.Colors[ci/3].B = lump.Data[ci+2]
					p.Colors[ci/3].A = 255
				}
				palettes[i] = p
			}
			return &palettes, nil
		}
	}
	return &palettes, nil
}
